<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>批量图片加水印工具</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
  <style>
    body {
        background-color: #f3f4f6;
    }

    .container {
        max-width: 800px;
        margin: 0 auto;
    }

    .preview-item {
        background-color: white;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        border-radius: 0.5rem;
        overflow: hidden;
        margin-bottom: 1rem;
    }

    .preview-item img {
        width: 100%;
        height: auto;
        display: block;
    }

    .preview-item p {
        text-align: center;
        margin-top: 0.5rem;
        font-size: 0.875rem;
        color: #555;
    }

    #processButton {
        width: 100%;
    }

    #previewContainer {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .ad-container {
        display: flex;
        justify-content: space-between;
        margin-bottom: 1rem;
        gap: 1rem;
    }

    .ad-box {
        flex: 1;
        background-color: #f9fafb;
        padding: 1rem;
        border: 1px solid #e5e7eb;
        border-radius: 0.5rem;
        text-align: center;
        font-weight: bold;
        color: #2563eb;
        text-decoration: none;
        transition: background-color 0.3s, color 0.3s;
    }

    .ad-box:hover {
        background-color: #2563eb;
        color: #ffffff;
    }
  </style>
</head>
<body class="bg-gray-100">

<header class="bg-blue-500 text-white text-center py-4 shadow-md">
  <h1 class="text-xl font-semibold">批量图片加水印工具</h1>
  <p class="text-sm">快速为多张图片添加自定义水印</p>
</header>

<div class="container mt-4">
  <div class="ad-container">
    <a href="https://www.icloud.com/shortcuts/26b1fa88f2b5493a964d9725b9f6e839" target="_blank" class="ad-box">每日领外卖红包</a>
    <a href="https://113tech.com/archives/category/cuts" target="_blank" class="ad-box">更多捷径</a>
  </div>
</div>

<div class="container bg-white p-6 rounded-lg shadow-md mt-4">
  <h1 class="text-lg font-semibold mb-4">设置水印</h1>

  <label for="fileInput" class="block text-gray-700 font-medium">选择图片（支持批量）</label>
  <input type="file" id="fileInput" multiple accept="image/*" class="w-full border border-gray-300 rounded-md p-2 mt-2">

  <label for="watermarkText" class="block text-gray-700 font-medium mt-4">水印文字</label>
  <input type="text" id="watermarkText" placeholder="请输入水印文字" class="w-full border border-gray-300 rounded-md p-2 mt-2">

  <label for="watermarkGrid" class="block text-gray-700 font-medium mt-4">水印密度</label>
  <select id="watermarkGrid" class="w-full border border-gray-300 rounded-md p-2 mt-2">
    <option value="3x3">3x3 (9 个水印)</option>
    <option value="5x5">5x5 (25 个水印)</option>
    <option value="7x7">7x7 (49 个水印)</option>
  </select>

  <label for="watermarkColor" class="block text-gray-700 font-medium mt-4">水印颜色</label>
  <input type="color" id="watermarkColor" value="#e3e3e3" class="w-full h-10 p-0 mt-2 border-none">

  <label for="opacity" class="block text-gray-700 font-medium mt-4">水印透明度</label>
  <input type="range" id="opacity" min="0" max="1" step="0.1" value="0.5" class="w-full mt-2">

  <label for="fontSize" class="block text-gray-700 font-medium mt-4">水印大小（字体 Px）</label>
  <input type="number" id="fontSize" value="20" class="w-full border border-gray-300 rounded-md p-2 mt-2">

  <button id="processButton" class="bg-blue-500 text-white font-semibold py-2 rounded-md mt-4 hover:bg-blue-600 transition">处理图片</button>
</div>

<div class="container mt-4">
  <h2 class="text-lg font-semibold mb-4">预览与保存（长按图片空白处，保存到相册）</h2>
  <div id="previewContainer" class="grid grid-cols-1 gap-4"></div>
</div>

<footer class="text-center text-gray-600 text-sm py-4 mt-8">
bilibili：三分糖的冻柠茶
</footer>

<script>
  const fileInput = document.getElementById('fileInput');
  const watermarkText = document.getElementById('watermarkText');
  const watermarkGrid = document.getElementById('watermarkGrid');
  const watermarkColor = document.getElementById('watermarkColor');
  const opacityInput = document.getElementById('opacity');
  const fontSize = document.getElementById('fontSize');
  const processButton = document.getElementById('processButton');
  const previewContainer = document.getElementById('previewContainer');

  processButton.addEventListener('click', () => {
    const files = fileInput.files;
    if (files.length === 0) {
      alert('请先选择图片！');
      return;
    }

    previewContainer.innerHTML = '';

    Array.from(files).forEach((file) => {
      const reader = new FileReader();
      reader.onload = (event) => {
        const img = new Image();
        img.onload = () => {
          const canvas = document.createElement('canvas');
          const ctx = canvas.getContext('2d');

          canvas.width = img.width;
          canvas.height = img.height;
          ctx.drawImage(img, 0, 0);

          const text = watermarkText.value || '水印';
          const color = watermarkColor.value;
          const opacity = parseFloat(opacityInput.value) || 0.5;
          const size = parseInt(fontSize.value, 10) || 20;
          const grid = watermarkGrid.value.split('x').map(Number);

          const cols = grid[0];
          const rows = grid[1];

          ctx.font = `${size}px Arial`;
          ctx.fillStyle = `rgba(${parseInt(color.slice(1, 3), 16)}, ${parseInt(color.slice(3, 5), 16)}, ${parseInt(color.slice(5, 7), 16)}, ${opacity})`;
          ctx.textAlign = 'center';
          ctx.textBaseline = 'middle';

          const cellWidth = canvas.width / cols;
          const cellHeight = canvas.height / rows;

          for (let i = 0; i < cols; i++) {
            for (let j = 0; j < rows; j++) {
              const x = i * cellWidth + cellWidth / 2;
              const y = j * cellHeight + cellHeight / 2;

              ctx.save();
              ctx.translate(x, y);
              ctx.rotate((45 * Math.PI) / 180);
              ctx.fillText(text, 0, 0);
              ctx.restore();
            }
          }

          const previewItem = document.createElement('div');
          previewItem.className = 'preview-item';
          const previewImage = new Image();
          previewImage.src = canvas.toDataURL('image/jpeg'); // 生成 JPG 格式
          previewItem.appendChild(previewImage);

          const infoText = document.createElement('p');
          infoText.textContent = 'iOS长按图片空白处（无文字），保存到相册';
          previewItem.appendChild(infoText);

          previewContainer.appendChild(previewItem);
        };
        img.src = event.target.result;
      };
      reader.readAsDataURL(file);
    });
  });
</script>
</body>
</html>
